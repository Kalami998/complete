(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{535:function(e,t,r){var content=r(623);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(31).default)("54eef472",content,!0,{sourceMap:!1})},622:function(e,t,r){"use strict";r(535)},623:function(e,t,r){var n=r(30),c=r(51),o=r(60),l=n((function(i){return i[1]})),d=c(o);l.push([e.i,'.none-style{display:none}.hide-element{border:0;height:0;margin:0;overflow:hidden;padding:0;width:0}@font-face{font-family:"AlibabaPuHuiTiH";font-style:normal;font-weight:400;src:url('+d+")}.rtc__area{align-items:center;display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:space-between;padding:10px}.rtc__left,.rtc__right{width:48%}.rtc__left_block{border:1px solid #bcb6b6;border-radius:5px;height:400px}.rtc__left_block video{height:100%;width:100%}.rtc__right_block{border:1px solid #bcb6b6;border-radius:5px;height:400px}.rtc__right_block video{height:100%;transform:scaleX(-1);width:100%}",""]),l.locals={},e.exports=l},796:function(e,t,r){"use strict";r.r(t);var n=r(16),c=(r(19),r(41),r(73),r(302),{head:function(){return{title:"vue文件模板",meta:"",description:"可用复制来快速创建文件",name:"模板",script:[]}},data:function(){return{rtc1:null,rtc2:null,singaling:null,configs:{},local:null,remote:null,localStream:null,remoteSream:null,sendData:null,receiveData:null,tracks:null}},mounted:function(){this.init()},methods:{init:function(){console.log("init"),this.local=document.getElementById("local"),this.remote=document.getElementById("remote")},getName:function(e){return"rtc1"===e?"rtc1":"rtc2"},getOtherPc:function(e){return"rtc1"===e?this.rtc2:this.rtc1},clearRtcPeer:function(){this.rtc1&&this.rtc1.close(),this.rtc1=null,this.rtc2&&this.rtc2.close(),this.rtc2=null},handleTrack:function(e){console.log("接受到数据",e)},handleStart:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 3:e.localStream=t.sent,e.local.srcObject=e.localStream,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),e.$message.error("获取本机摄像头失败!，请检查是否授予页面摄像头/音频使用权限");case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},handleEnd:function(){this.localStream.getTracks().forEach((function(track){track.stop()})),this.localStream=null,this.local.srcObject=null,this.remote.srcObject=null,this.clearRtcPeer()},handleJoin:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{r=e.localStream.getVideoTracks(),n=e.localStream.getAudioTracks(),r.length>0&&console.log("Using video device: ".concat(r[0].label)),n.length>0&&console.log("Using audio device: ".concat(n[0].label)),e.rtc1=new RTCPeerConnection(e.configs),e.rtc2=new RTCPeerConnection(e.configs),e.rtc1.onicecandidate=function(t){e.handleIcecanddidate("rtc1",t)},e.rtc2.onicecandidate=function(t){e.handleIcecanddidate("rtc2",t)},e.rtc2.ontrack=function(t){console.log("远端接受到数据",t),e.remote.srcObject!==t.streams[0]&&(e.remote.srcObject=t.streams[0])},e.localStream.getTracks().forEach((function(track){e.rtc1.addTrack(track,e.localStream)})),e.handleCreate()}catch(t){e.$message.error("视频轨道添加到通信实例失败"),e.clearRtcPeer()}case 1:case"end":return t.stop()}}),t)})))()},handleIcecanddidate:function(e,t){var r=this;return Object(n.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,r.getOtherPc(e).addIceCandidate(t.candidate);case 3:n.next=9;break;case 5:n.prev=5,n.t0=n.catch(0),r.$message("为".concat(r.getName(e),"添加addIceCandidate失败")),r.clearRtcPeer();case 9:case"end":return n.stop()}}),n,null,[[0,5]])})))()},handleCreate:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("createOffer start"),t.prev=1,t.next=4,e.rtc1.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1});case 4:r=t.sent,e.handleDescription(r),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),e.$message.error("创建通信数据失败"),e.clearRtcPeer();case 12:case"end":return t.stop()}}),t,null,[[1,8]])})))()},handleDescription:function(data){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=function(e){console.log("失败回调",e)},r=function(e){console.log("回调函数",e)},console.log("localDescription start"),t.prev=3,t.next=6,e.rtc1.setLocalDescription(data,r,n);case 6:t.next=12;break;case 8:t.prev=8,t.t0=t.catch(3),e.$message.error("设置本地通信数据失败"),e.clearRtcPeer();case 12:return t.prev=12,t.next=15,e.rtc2.setRemoteDescription(data);case 15:t.next=21;break;case 17:t.prev=17,t.t1=t.catch(12),e.$message.error("设置远程通信数据失败"),e.clearRtcPeer();case 21:e.handleAnswer();case 22:case"end":return t.stop()}}),t,null,[[3,8],[12,17]])})))()},handleAnswer:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("answer start"),t.prev=1,t.next=4,e.rtc2.createAnswer();case 4:r=t.sent,console.log(r),e.handleAnswerInfo(r),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(1),e.$message.error("创建数据接受者失败"),e.clearRtcPeer();case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()},handleAnswerInfo:function(data){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=function(e){console.log("失败回调",e)},r=function(e){console.log("回调函数",e)},console.log("remoteDescrip start"),t.prev=3,t.next=6,e.rtc2.setLocalDescription(data,r,n);case 6:t.next=12;break;case 8:t.prev=8,t.t0=t.catch(3),e.$message.error("设置本地通信数据失败"),e.clearRtcPeer();case 12:return t.prev=12,t.next=15,e.rtc1.setRemoteDescription(data);case 15:t.next=21;break;case 17:t.prev=17,t.t1=t.catch(12),e.$message.error("设置远程通信数据失败"),e.clearRtcPeer();case 21:case"end":return t.stop()}}),t,null,[[3,8],[12,17]])})))()}}}),o=(r(622),r(15)),component=Object(o.a)(c,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"rtc"},[t("contents",[t("codes",[e._v("RTCCONNECTION")]),e._v(" "),t("br"),e._v("\n        1.通过 "),t("codes",[e._v("getUserMedia")]),e._v(" 访问 摄像头/麦克风\n        信息，可以拿到媒体流数据。"),t("br"),e._v("\n        2.通过点通信方法\n        "),t("codes",[e._v("RTCPeerConnection")]),e._v(" 声明俩实例，一个作为本地端（offer\n        提供数据），一个作为远端（answer，接受数据后响应处理）\n        "),t("br"),e._v("\n        3.本地端通过\n        "),t("codes",[e._v(" createOffer ")]),e._v("\n        方法生成描述信息，用作offer端的本地描述("),t("codes",[e._v("setLocalDescription")]),e._v(")、answer端的获取描述\n        ("),t("codes",[e._v("setRemoteDescription")]),e._v(")。远端通过\n        "),t("codes",[e._v(" createAnswer ")]),e._v("\n        生成描述信息，用作answer端的本地描述、offer端的获取描述。设置俩端描述后，俩端将成为ice候选者同时触发自身iceCandidate事件，在该函数内通过\n        自身"),t("codes",[e._v("addIceCandidate")]),e._v("\n        将对方添加到自己 PeerConnection\n        中，从而达到俩端链接，打通通信通道。注意写代码时的执行顺序！\n        "),t("br"),e._v("\n        4. 现在，本地端通过 "),t("codes",[e._v("addTrack")]),e._v("\n        将现有的媒体流轨道数据发送到信令通道，远端通过"),t("codes",[e._v("ontrack")]),e._v("监听拿到数据\n    ")],1),e._v(" "),e._m(0),e._v(" "),t("div",[e.localStream?t("el-button",{on:{click:e.handleEnd}},[e._v("停止")]):t("el-button",{on:{click:e.handleStart}},[e._v("获取摄像头")]),e._v(" "),e.rtc1?e._e():t("el-button",{on:{click:e.handleJoin}},[e._v("加入通信")])],1)],1)}),[function(){var e=this,t=e._self._c;return t("div",{staticClass:"rtc__area"},[t("div",{staticClass:"rtc__left"},[t("div",[e._v("local:")]),e._v(" "),t("div",{staticClass:"rtc__left_block"},[t("video",{attrs:{id:"local",autoplay:"",playsinline:""}})])]),e._v(" "),t("div",{staticClass:"rtc__right"},[t("div",[e._v("remote:")]),e._v(" "),t("div",{staticClass:"rtc__right_block"},[t("video",{attrs:{id:"remote",autoplay:"",playsinline:""}})])])])}],!1,null,null,null);t.default=component.exports}}]);