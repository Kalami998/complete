(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{543:function(e,t,o){var content=o(643);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,o(31).default)("1b209738",content,!0,{sourceMap:!1})},642:function(e,t,o){"use strict";o(543)},643:function(e,t,o){var r=o(30),n=o(51),c=o(60),l=r((function(i){return i[1]})),d=n(c);l.push([e.i,'.none-style{display:none}.hide-element{border:0;height:0;margin:0;overflow:hidden;padding:0;width:0}@font-face{font-family:"AlibabaPuHuiTiH";font-style:normal;font-weight:400;src:url('+d+")}.page__area{align-items:stretch;background:#ebecec;display:flex;flex-direction:row;flex-wrap:wrap;justify-content:flex-start;margin:0 0 20px;min-height:300px;width:100%}.page__area_video{flex:1;height:300px}.page__list{align-items:stretch;background:#ebecec;display:flex;flex-direction:wrap;flex-wrap:row;justify-content:flex-start;margin:0 0 20px;width:100%}.page__list_item{height:200px;margin:0 10px 10px 0;width:200px}.page__list_item img{max-height:200px;max-width:200px;-o-object-fit:contain;object-fit:contain}.page__operate_button{margin:0 10px 10px 0}",""]),l.locals={},e.exports=l},801:function(e,t,o){"use strict";o.r(t);o(155);var r=o(16),n=(o(115),o(19),o(40),o(41),o(45),o(114),o(542),o(305),o(73),{head:function(){return{title:"webrtc",meta:"",description:"练习webrtc",script:[]}},data:function(){return{imgList:[],canvas:{width:"300px",height:"300px"},showImg:!1,filterList:["blur(5px)","brightness(0.5)","contrast(200%)","grayscale(100%)","hue-rotate(90deg)","invert(100%)","opacity(90%)","saturate(200%)","saturate(20%)","sepia(100%)","drop-shadow(4px 4px 8px blue)"],supported:[],localStream:"",mediaRecorder:null,blobList:[],recordType:"interval",blobData:"",timer:null,timecell:3e3,mediaOptions:{audioBitsPerSecond:128e3,videoBitsPerSecond:25e5,mimeType:"video/webm"}}},mounted:function(){this.getSupportMimeTypes()},methods:{join:function(){this.getUserMedia()},leave:function(){document.querySelector("#userVideo").srcObject=null},sharScreen:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getDisplayMedia({audio:!0,video:!0});case 3:o=t.sent,e.playStream(o),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log("Error: 获取屏幕媒体流信息失败!");case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},playStream:function(e){console.log("视屏流信息",e),document.querySelector("#localVideo").srcObject=e},getUserMedia:function(){return Object(r.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 3:t=e.sent,document.querySelector("#userVideo").srcObject=t,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("Error: 获取摄像头/音频流信息失败!, 请检查是否授予页面摄像头/音频使用权限");case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},takePhoto:function(){var e=document.querySelector("#localVideo");if(e.srcObject){console.log("视频元素",e.srcObject);var canvas=document.createElement("canvas");canvas.width=e.videoWidth,canvas.height=e.videoHeight,canvas.getContext("2d").drawImage(e,0,0,canvas.width,canvas.height),this.imgList.push(canvas.toDataURL("image/png"));var img=document.createElement("img");img.className="page__list_item",img.src=canvas.toDataURL("image/png"),document.querySelector("#imgarea").appendChild(img)}else console.log("Warning 请先分享视频")},getDevices:function(){return Object(r.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:t=e.sent,console.log("🚀🚀🚀 / devices",t);case 4:case"end":return e.stop()}}),e)})))()},getSupportMimeTypes:function(){var e=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h264"],t=MediaRecorder.isTypeSupported,o=[];["webm","mp4","ogg","mov","avi","wmv","flv","mkv","ts","x-matroska"].forEach((function(r){var n="".concat("video","/").concat(r);e.forEach((function(e){["".concat(n,";codecs=").concat(e),"".concat(n,";codecs=").concat(e.toUpperCase())].forEach((function(e){t(e)&&o.push(e)}))})),t(n)&&o.push(n)})),this.supported=o,this.mediaOptions.mimeType=this.supported[0],console.log("支持的视屏类型",this.supported)},startRecord:function(e){var t=this,o="";(o=1==e?document.querySelector("#userVideo").srcObject||null:document.querySelector("#localVideo").srcObject||null)?(this.mediaRecorder=new MediaRecorder(o,this.mediaOptions),"all"==this.recordType?(this.setRecorder(),this.mediaRecorder.start()):(this.setRecorder(),this.mediaRecorder.start(),this.timer=setInterval((function(){t.mediaRecorder.stop(),t.mediaRecorder.start()}),this.timecell)),console.log("mediaRecorder实例",this.mediaRecorder)):console.log("未获取到".concat(1==e?"用户":"屏幕","相关流数据"))},setInterval:function(){var e=this;this.blobList=[],this.mediaRecorder.ondataavailable=function(t){t.data.size>1048576&&(console.log("存入数据",t.data),e.blobList.push(t.data))}},setRecorder:function(){var e=this;this.mediaRecorder.ondataavailable=function(t){if("all"==e.recordType)e.blobData=new Blob([t.data],{type:"video/webm"});else{var o=new Blob([t.data],{type:"video/webm"});e.downloadNow(o)}}},stopRecord:function(){var e;this.timer&&(clearInterval(this.timer),this.timer=null),"inactive"!==(null===(e=this.mediaRecorder)||void 0===e?void 0:e.state)&&this.mediaRecorder.stop()},downloadVideo:function(){"all"==this.recordType&&this.downloadBlob()},downloadNow:function(data){var e=URL.createObjectURL(data),a=document.createElement("a");a.href=e,a.download="".concat((new Date).getTime(),".webm"),a.click(),URL.revokeObjectURL(e)},intervalDownload:function(){console.log("blobList",this.blobList);var e=new Blob(this.blobList,{type:"video/webm"}),t=window.URL.createObjectURL(e);console.log("临时路由",t);var o=document.createElement("video");o.className="page__area_video",o.src=t,o.controls="controls",document.querySelector(".page__area").appendChild(o);var a=document.createElement("a");a.style.display="none",a.href=t,a.download="list".concat(i,".webm"),document.body.appendChild(a),a.click(),setTimeout((function(){window.URL.revokeObjectURL(t),document.body.removeChild(a)}),100)},downloadBlob:function(){var e;if(null!==(e=this.blobData)&&void 0!==e&&e.type){var t=URL.createObjectURL(this.blobData),a=document.createElement("a");a.href=t,a.download="".concat((new Date).getTime(),".").concat(this.blobData.type.split("/")[1]),a.click(),URL.revokeObjectURL(t)}else console.log("未录制视频")}},beforeDestroy:function(){clearInterval(this.timer),this.timer}}),c=(o(642),o(15)),component=Object(c.a)(n,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"page"},[t("contents",[t("codes",[e._v("usermedia")]),e._v(" 分享屏幕视频流信息 ")],1),e._v(" "),t("div",{staticClass:"page__area"},[t("video",{staticClass:"page__area_video",attrs:{id:"localVideo",autoplay:"",playsinline:"",muted:""},domProps:{muted:!0}}),e._v(" "),t("video",{staticClass:"page__area_video",attrs:{id:"userVideo",autoplay:"",playsinline:"",muted:""},domProps:{muted:!0}})]),e._v(" "),t("div",{staticClass:"page__list",attrs:{id:"imgarea"}}),e._v(" "),t("div",{staticClass:"page__operate"},[t("el-button",{staticClass:"page__operate_button",attrs:{type:"primary"},on:{click:e.join}},[e._v("加入")]),e._v(" "),t("el-button",{staticClass:"page__operate_button",attrs:{type:"primary"},on:{click:e.leave}},[e._v("离开")]),e._v(" "),t("el-button",{staticClass:"page__operate_button",attrs:{type:"primary"},on:{click:e.takePhoto}},[e._v("拍照")]),e._v(" "),t("el-button",{staticClass:"page__operate_button",attrs:{type:"primary"},on:{click:e.sharScreen}},[e._v("分享屏幕")]),e._v(" "),t("el-select",{staticClass:"page__operate_button",attrs:{placeholder:"请选择录制方式"},model:{value:e.recordType,callback:function(t){e.recordType=t},expression:"recordType"}},[t("el-option",{attrs:{label:"一次性录制",value:"all"}}),e._v(" "),t("el-option",{attrs:{label:"间隔录制",value:"interval"}})],1)],1),e._v(" "),t("div",{staticClass:"page__operate"},[t("el-button",{staticClass:"page__operate_button",attrs:{type:"primary"},on:{click:function(t){return e.startRecord(1)}}},[e._v("录制用户视频")]),e._v(" "),t("el-button",{staticClass:"page__operate_button",attrs:{type:"primary"},on:{click:function(t){return e.startRecord(2)}}},[e._v("录制屏幕视频")]),e._v(" "),t("el-button",{staticClass:"page__operate_button",attrs:{type:"primary"},on:{click:e.stopRecord}},[e._v("结束录制")]),e._v(" "),t("el-button",{staticClass:"page__operate_button",attrs:{type:"primary"},on:{click:e.downloadVideo}},[e._v("下载录制视频")])],1)],1)}),[],!1,null,null,null);t.default=component.exports}}]);